<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Analytic Hierarchy Process</title>
    <script type="text/javascript" src="Scripts/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <script src="Scripts/jquery.table2excel.js"></script>

    <script type="text/javascript">
      //OMER HADAR MARCH 23

      var Util = function () {};

      Util.getPermuts = function (array, start, output) {
        if (start >= array.length) {
          var arr = array.slice(0); //clone the array
          output.push(arr);
        } else {
          var i;

          for (i = start; i < array.length; ++i) {
            Util.swap(array, start, i);
            Util.getPermuts(array, start + 1, output);
            Util.swap(array, start, i);
          }
        }
      };

      Util.getAllPossiblePermuts = function (array, output) {
        Util.getPermuts(array, 0, output);
      };

      Util.swap = function (array, from, to) {
        var tmp = array[from];
        array[from] = array[to];
        array[to] = tmp;
      };
      Util.getRPermuts = function (array, size, initialStuff, output) {
        if (initialStuff.length >= size) {
          output.push(initialStuff);
        } else {
          var i;

          for (i = 0; i < array.length; ++i) {
            Util.getRPermuts(
              array,
              size,
              initialStuff.concat(array[i]),
              output
            );
          }
        }
      };

      Util.getAllPossibleRPermuts = function (array, size, output) {
        Util.getRPermuts(array, size, [], output);
      };

      Util.storeLastMove = function () {
        localStorage.setItem("connections", JSON.stringify(connections));
        localStorage.setItem("values", JSON.stringify(values));
      };

      Util.store = function (name) {
        localStorage.setItem(
          name + "_connections",
          JSON.stringify(connections)
        );
        localStorage.setItem(name + "_values", JSON.stringify(values));
      };

      Util.getNames = function () {
        return JSON.parse(localStorage.getItem("names"));
      };

      Util.setNames = function (names) {
        localStorage.setItem("names", JSON.stringify(names));
      };

      Util.restore = function (name) {
        Util.storeLastMove();
        connections = JSON.parse(localStorage.getItem(name + "_connections"));
        values = JSON.parse(localStorage.getItem(name + "_values"));
        refresh();
      };

      Util.deleteName = function (name) {
        debugger;
        localStorage.removeItem(name + "_connections");
        localStorage.removeItem(name + "_values");
        arr = Util.getNames();
        var filteredArray = arr.filter((e) => e !== name);
        Util.setNames(filteredArray);
      };

      var values = new Array();
      var connections = new Array();
      var minid;
      var minallid;
      var output;
      $(document).ready(function () {
        $(document).on("click", "#changeall", function () {
          Util.storeLastMove();
          var arr = output[minallid];
          Util.apply();
          for (i = 0; i < connections.length; i++)
            connections[i].delta =
              parseInt(connections[i].delta) + eval(arr[i]);
          refresh();
        });
        $(document).on(
          {
            mouseenter: function () {
              var arrayofchange = output[minallid];
              for (i = 0; i < connections.length; i++) {
                var selector = connections[i].input;
                var b = parseInt(arrayofchange[i]);
                var val = $("#" + selector).val();
                console.log(val);
                if (val.toString().includes("/")) {
                  newVal = parseInt(val.split("/")[1]) + b;
                  $("#" + selector).val("1/" + newVal.toString());
                } else {
                  $("#" + selector).val(eval(connections[i].delta) + b);
                }
                if (b != 0) $("#" + selector).css("background", "yellow");
              }
            },
            mouseleave: function () {
              var arrayofchange = output[minallid];
              for (i = 0; i < connections.length; i++) {
                var selector = connections[i].input;
                var val = $("#" + selector).val();
                if (val.toString().includes("/")) {
                  $("#" + selector).val("1/" + connections[i].delta.toString());
                } else {
                  $("#" + selector).val(eval(connections[i].delta));
                }
                $("#" + selector).css("background", "#f1f1f1");
              }
            },
          },
          "#changeall"
        );
        $("#firstval").focus();
        $("#firstval").keydown(function (e) {
          if (e.keyCode == 13) {
            e.preventDefault();
            if ($("#firstval").val() != "") $("#addval").click();
            else alert("Please enter a value");
            $("#firstval").val("");
          }
        });
        $("#addval").click(function () {
          $("#ci").remove();
          if ($("#firstval").val() === "") {
            alert("Please enter a value");
          } else {
            pushvalue($("#firstval").val());
          }
        });
        $("#reset").click(function () {
          Util.storeLastMove();
          values.length = 0;
          connections.length = 0;
          refresh();
          $("table").remove();
        });

        $("#undo").click(function () {
          refresh(true);
        });

        $("#dwn-btn").on("click", function () {
          buildtableforexcel();
          $(".excel").table2excel({
            // exclude CSS class

            exclude: ".noEXL",

            name: "AHP",

            filename: "AHP Export", //do not include extension

            fileext: ".xls", // file extension
            preserveColors: true,
          });
        });
      });

      function pushvalue(a) {
        Util.storeLastMove();
        var ok = 0;
        var value;
        for (i = 0; i < values.length; i++) {
          if (values[i].name == a) {
            ok = 1;
          }
        }

        if (ok == 0) {
          var aname = a;
          a = a.replace(/ /g, "-");
          values.push({ id: a, name: aname, value: 9, num: values.length + 1 });
        }

        for (i = 0; i < values.length - 1; i++)
          connections.push({
            value1: values[i].id,
            value2: a,
            delta: 0,
            mode: "regular",
            input: values[i].id + "_" + a + "input",
          });

        $("svg").remove();
        $(".buttons").remove();
        buildtable();
        sumColunm(connections);
        refresh();
      }
      function getColorById(n) {
        return choosecolor(
          values.filter(function (a) {
            return a.id == n;
          })[0].num - 1
        );
      }

      //checks if there is a connection between 2 vars
      function istherecon(a, b, cons) {
        for (k = 0; k < cons.length; k++) {
          if (cons[k].value1 == a && cons[k].value2 == b) return 1;
        }
        return 0;
      }
      //colors for lines
      function choosecolor(a) {
        if (a == 0) return "#bae1ff";
        if (a == 1) return "#baffc9";
        if (a == 2) return "#ffffba";
        if (a == 3) return "#ffdfba";
        if (a == 4) return "#ffb3ba";
        if (a == 5) return "#0082e6";
        if (a == 6) return "#00cc2c";
        return "silver";
      }
      function changeValues(firstValueID, secondValueID, delta) {
        var firstVal = values.filter(function (a) {
          return a.id == firstValueID;
        })[0];
        var secondVal = values.filter(function (a) {
          return a.id == secondValueID;
        })[0];
        if (firstVal.num == 1) {
          secondVal.value = firstVal.value - delta;
        }
        if (secondVal.num == 1) {
          firstVal.value = secondVal.value + delta;
        }
      }

      function createConnection(ev) {
        Util.storeLastMove();
        var id = ev.target.id;
        id = id.substring(0, id.length - 5);
        var firstvalue = id.split("_")[0];
        var secondvalue = id.split("_")[1];
        var delta = $("#" + id + "input").val();
        connenction = connections.filter(function (a) {
          return (
            (a.value1 == firstvalue && a.value2 == secondvalue) ||
            (a.value1 == secondvalue && a.value2 == firstvalue)
          );
        });
        if (connenction.length > 0) {
          if (connenction[0].value1 === firstvalue) {
            if (eval(delta) >= 1)
              connenction[0].delta = $("#" + id + "input").val();
            else {
              delta = 1 / eval($("#" + id + "input").val());
              connenction[0].delta = delta;
              connenction[0].value1 = secondvalue;
              connenction[0].value2 = firstvalue;
              values.filter(function (a) {
                return a.id == secondvalue;
              })[0].value = values.filter(function (a) {
                return a.id == firstvalue;
              })[0].value;
              delta = delta * -1;
            }
          } else {
            if (eval(delta) >= 1) {
              connenction[0].delta = $("#" + id + "input").val();
              connenction[0].value1 = firstvalue;
              connenction[0].value2 = secondvalue;
              values.filter(function (a) {
                return a.id == firstvalue;
              })[0].value = values.filter(function (a) {
                return a.id == secondvalue;
              })[0].value;
            } else {
              delta = 1 / eval($("#" + id + "input").val());
              connenction[0].delta = delta;
              delta = delta * -1;
            }
          }
        }

        if (
          $("#" + id + "input").val() != 1 &&
          values.filter(function (a) {
            return a.id == firstvalue;
          })[0].num == 1
        )
          values.filter(function (a) {
            return a.id == secondvalue;
          })[0].value =
            values.filter(function (a) {
              return a.id == firstvalue;
            })[0].value - delta;
        else if (
          values.filter(function (a) {
            return a.id == firstvalue;
          })[0].num == 1
        )
          values.filter(function (a) {
            return a.id == secondvalue;
          })[0].value = values.filter(function (a) {
            return a.id == firstvalue;
          })[0].value;
        // if (eval($("#" + id + "input").val()) < 1)
        //  values.sort(function (a, b) { return b.value - a.value });

        refresh();
      }
      function matrixTable(arrconnections) {
        var deltafortablel;
        var matrix = new Array(values.length);
        for (i = 0; i < values.length; i++)
          matrix[i] = new Array(values.length);

        for (i = 0; i < values.length; i++) {
          for (j = 0; j < values.length; j++) {
            matrix[i][j] = 0;
            if (i == j) matrix[i][j] += 1;
            else if (
              istherecon(values[i].name, values[j].name, arrconnections) == 1
            ) {
              deltafortablel = arrconnections.filter(function (a) {
                return a.value1 == values[i].name && a.value2 == values[j].name;
              })[0].delta;
              matrix[i][j] += eval(deltafortablel);
            } else if (
              istherecon(values[j].name, values[i].name, arrconnections) == 1
            )
              matrix[i][j] +=
                1 /
                eval(
                  arrconnections.filter(function (a) {
                    return (
                      a.value1 == values[j].name && a.value2 == values[i].name
                    );
                  })[0].delta
                );
          }
        }
        console.log("matrix:");
        console.log(matrix);
        return matrix;
      }

      // for matrix table
      function buildtable() {
        $(".tableresults").remove();
        var deltafortablel;
        var table = "";
        var id;
        table += "<table class='tableresults cons'>";
        table += "<tr>";
        table += "<td></td>";
        for (i = 0; i < values.length; i++)
          table +=
            "<td style='background:" +
            choosecolor(values[i].num - 1) +
            "'>" +
            values[i].name +
            "</td>";

        table += "</tr>";
        for (i = 0; i < values.length; i++) {
          table += "<tr>";
          table += "<td>" + values[i].name + "</td>";
          for (j = 0; j < values.length; j++) {
            if (i == j) table += "<td>1</td>";
            else if (i < j) {
              try {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[i].name && a.value2 == values[j].name
                  );
                })[0].delta;
              } catch {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[j].name && a.value2 == values[i].name
                  );
                })[0].delta;
                deltafortablel = 1 / deltafortablel;
              }

              id = values[i].id + "_" + values[j].id + "input";

              if (deltafortablel == 0)
                table +=
                  "<td><select class='redback' onchange='createConnection(event)' id='" +
                  id +
                  "' height='20vh'>";
              else
                table +=
                  "<td><select onchange='createConnection(event)' id='" +
                  id +
                  "' height='20vh'>";
              for (k = -9; k < 10; k++) {
                if (k < 0 && k != -1) {
                  if (eval(deltafortablel) == 1 / (k * -1))
                    table +=
                      " <option selected='true' value='1/" +
                      k * -1 +
                      "'>1/" +
                      k * -1 +
                      "</option>";
                  else
                    table +=
                      " <option value='1/" +
                      k * -1 +
                      "'>1/" +
                      k * -1 +
                      "</option>";
                } else if (k != -1) {
                  if (deltafortablel == k)
                    table +=
                      " <option selected='true' value='" +
                      k +
                      "'>" +
                      k +
                      "</option>";
                  else
                    table += " <option  value='" + k + "'>" + k + "</option>";
                }
              }
              table += "</select></td>";
            } else if (i > j) {
              try {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[j].name && a.value2 == values[i].name
                  );
                })[0].delta;
              } catch {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[i].name && a.value2 == values[j].name
                  );
                })[0].delta;
                deltafortablel = 1 / deltafortablel;
              }
              table += "<td>" + fixNumber(deltafortablel) + "</td>";
            }
          }
          table += "</tr>";
        }
        table += "</table>";
        $("#main").append(table);
      }

      function drawChart(citeriaWeights) {
        $("#myChart").remove();
        $("#chart").append('<canvas id="myChart"></canvas>');
        var xValues = values.map((a) => a.name);
        var yValues = citeriaWeights;
        var barColors = [
          "#bae1ff",
          "#baffc9",
          "#ffffba",
          "#ffdfba",
          "#ffb3ba",
          "#baffc9",
          "#00cc2c",
        ];

        new Chart("myChart", {
          type: "doughnut",
          data: {
            labels: xValues,
            datasets: [
              {
                backgroundColor: barColors,
                data: yValues,
              },
            ],
          },
          options: {
            title: {
              display: true,
              text: "Citeria Weights",
            },
          },
        });
      }

      // for excel export
      function buildtableforexcel() {
        $(".excel").remove();
        var deltafortablel;
        var table = "";
        var id;
        table += "<table class='excel' style='display:none'>";
        table += "<tr>";
        table += "<td></td>";
        for (i = 0; i < values.length; i++)
          table +=
            "<td style='background:" +
            choosecolor(values[i].num - 1) +
            "'>" +
            values[i].name +
            "</td>";

        table += "</tr>";
        for (i = 0; i < values.length; i++) {
          table += "<tr>";
          table += "<td>" + values[i].name + "</td>";
          for (j = 0; j < values.length; j++) {
            if (i == j) table += "<td>1</td>";
            else if (i < j) {
              try {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[i].name && a.value2 == values[j].name
                  );
                })[0].delta;
              } catch {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[j].name && a.value2 == values[i].name
                  );
                })[0].delta;
                deltafortablel = 1 / deltafortablel;
              }

              id = values[i].id + "_" + values[j].id + "input";

              table += "<td>" + eval(deltafortablel) + "</td>";
            } else if (i > j) {
              try {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[j].name && a.value2 == values[i].name
                  );
                })[0].delta;
              } catch {
                deltafortablel = connections.filter(function (a) {
                  return (
                    a.value1 == values[i].name && a.value2 == values[j].name
                  );
                })[0].delta;
                deltafortablel = 1 / deltafortablel;
              }
              table += "<td>" + eval(fixNumber(deltafortablel)) + "</td>";
            }
          }
          table += "</tr>";
        }
        table += "</table>";
        $("#main").append(table);
      }
      function fixNumber(number) {
        var stringToReturn = "";
        if (number > 1) {
          stringToReturn += "1/";
          stringToReturn += number;
        } else if (number < 1 && number > 0) {
          stringToReturn = number / number / number;
        } else stringToReturn = number;
        return stringToReturn;
      }

      function fixNumberText(number) {
        var stringToReturn = "";
        if (number < 1 && number > 0) {
          stringToReturn += "1/";
          stringToReturn += number / number / number;
        } else stringToReturn = number;
        return stringToReturn;
      }

      //for normalization table
      function sumColunm(arrconnections) {
        //sumcolunm
        for (i = 0; i < arrconnections.length; i++)
          if (arrconnections[i].delta == 0) return 10;
        var sumcolunm = new Array();
        var matrix = matrixTable(arrconnections);
        if (values.length > 1)
          for (i = 0; i < values.length; i++) {
            sumcolunm.push(0);
            for (j = 0; j < values.length; j++)
              sumcolunm[i] += eval(matrix[j][i]);
          }

        console.log("sumcolunm:");
        console.log(sumcolunm);
        //pairwishmatrix

        var pairwisematrix = new Array(values.length);
        for (i = 0; i < values.length; i++)
          pairwisematrix[i] = new Array(values.length);
        for (i = 0; i < values.length; i++)
          for (j = 0; j < values.length; j++)
            pairwisematrix[j][i] = matrix[j][i] / sumcolunm[i];

        console.log("pairwisematrix:");
        console.log(pairwisematrix);
        var citeriaWeights = new Array(values.length);
        //citeriaweights
        for (i = 0; i < values.length; i++) {
          citeriaWeights[i] = 0;
          for (j = 0; j < values.length; j++)
            citeriaWeights[i] += eval(pairwisematrix[i][j]);
        }
        for (i = 0; i < values.length; i++)
          citeriaWeights[i] = citeriaWeights[i] / values.length;

        console.log("citeriaweights:");
        console.log(citeriaWeights);
        if (!citeriaWeights.includes(NaN)) drawChart(citeriaWeights);

        //weighted sum value
        var matrixandciteriaWeights = matrix.slice(0);
        for (i = 0; i < values.length; i++)
          for (j = 0; j < values.length; j++)
            matrixandciteriaWeights[j][i] =
              eval(matrixandciteriaWeights[j][i]) * eval(citeriaWeights[i]);
        console.log("matrixandciteriaWeights:");
        console.log(matrixandciteriaWeights);
        var weightedsumVal = new Array(values.length);
        for (i = 0; i < values.length; i++) {
          weightedsumVal[i] = 0;
          for (j = 0; j < values.length; j++)
            weightedsumVal[i] += matrixandciteriaWeights[i][j];
        }

        console.log("weightedsumVal:");
        console.log(weightedsumVal);
        //weightedsumval / citeriaweight
        var wsvAndCw = weightedsumVal.slice(0);

        for (i = 0; i < values.length; i++)
          wsvAndCw[i] = weightedsumVal[i] / citeriaWeights[i];
        console.log("weightedsumVal/citeriaweight:");
        console.log(wsvAndCw);

        //consistency index
        var consistencyIndex = 0;
        for (i = 0; i < values.length; i++) consistencyIndex += wsvAndCw[i];
        consistencyIndex = consistencyIndex / values.length;
        consistencyIndex =
          (consistencyIndex - values.length) / (values.length - 1);
        console.log("consistenytIndex:");
        console.log(consistencyIndex);

        //consistency ratio
        var consistecyratio = consistencyIndex / returnRatio(values.length);
        console.log("consistecyratio:");
        console.log(consistecyratio);
        if (arrconnections == connections) {
          $("#ci").remove();
          if (consistecyratio >= 0 && consistecyratio < 0.1)
            $("#main").append(
              "<p id='ci'>CR : " +
                consistecyratio.toString().substring(0, 5) +
                "</p>"
            );
          else if (consistecyratio > 0.1)
            $("#main").append(
              "<p id='ci' class='redback'>CI : " +
                consistecyratio.toString().substring(0, 5) +
                "</p>"
            );
        }
        return consistecyratio;
      }
      function minRatio() {
        var moves = 0;
        var moved = [];
        output = [[]];
        for (i = 0; i < connections.length; i++) {
          output[0][i] = 0;
        }
        var tryRatio1 = [];
        connectionsCloned = structuredClone(connections);
        while (tryRatio1.length == 0 && moves < connections.length) {
          var tryRatio = new Array(values.length * 2);
          var m = 0;
          for (m = 0; m < connectionsCloned.length; m++) {
            if (!moved.includes(m)) {
              tryRatio[m * 2] = sumColunm(addTo(connectionsCloned, m, 1));
              tryRatio[m * 2 + 1] = sumColunm(addTo(connectionsCloned, m, -1));
            } else {
              tryRatio[m * 2] = 10;
              tryRatio[m * 2 + 1] = 10;
            }
          }

          console.log("ratio are:");
          console.log(tryRatio);

          var minInThisCycle = Math.min(...tryRatio);
          var minInThisCycleId = tryRatio.indexOf(minInThisCycle);
          var connectionId = Math.floor(minInThisCycleId / 2);
          var plusOrMinus = minInThisCycleId % 2 === 0 ? 1 : -1;
          moved.push(connectionId);
          moves++;
          output[0][connectionId] = plusOrMinus;
          tryRatio1 = tryRatio.filter(function (a) {
            return eval(a) >= 0 && eval(a) < 0.1;
          });
          if (tryRatio1.length == 0) {
            connectionsCloned = addTo(
              connectionsCloned,
              connectionId,
              plusOrMinus
            );
          }
        }
        var minimum = Math.min(...tryRatio1);
        minid = tryRatio.indexOf(minimum);

        console.log("minimum: " + minimum);
        var change = "";
        var currentci = eval($("#ci").text().toString().substring(6));
        $("#changeall").remove();
        if (
          currentci > 0.1 &&
          minimum < currentci &&
          minimum >= 0 &&
          connections.filter(function (a) {
            return a.delta == 0;
          }).length == 0
        ) {
          change =
            "<a id='changeall' class='button'>Improve CI to : " +
            minimum.toString().substring(0, 5) +
            "</a>";
          minallid = 0;
        } else if (minid == -1 && currentci > 0) {
          change =
            "<p id='changeall'>Sorry we can't lower the CI (under 0.1) with 1 move :(</p>";
          minallid = -1;
        }
        $("#main").append(change);
      }
      function addTo(arr, place, num) {
        var newarray = [...arr].map((i) => ({ ...i }));

        newarray[place].delta = eval(newarray[place].delta) + eval(num);
        return newarray;
      }
      function minRatioAll() {
        var tryRatio = new Array(Math.pow(3, values.length));
        var arrayCombinations = [0, -1, 1];
        output = [];
        var papersNo = connections.length;
        Util.getAllPossibleRPermuts(arrayCombinations, papersNo, output);
        var m = 0;
        for (m = 0; m < output.length; m++) {
          tryRatio[m] = sumColunm(addToMulti(connections, output[m]));
        }
        console.log("ratio all are:");
        console.log(tryRatio);
        tryRatio1 = tryRatio.filter(function (a) {
          return eval(a) >= 0 && eval(a) < 0.1;
        });
        var minimum = Math.min(...tryRatio1);
        minallid = tryRatio.indexOf(minimum);
        console.log("minimumall: " + minimum);
        var change = "";
        var currentci = eval($("#ci").text().toString().substring(6));

        if (minimum < currentci && minimum >= 0)
          change =
            "<a id='changeall' class='button'>Improve CI to : " +
            minimum.toString().substring(0, 5) +
            "</a>";
        else if (minid == -1 && currentci > 0)
          change =
            "<p id='changeall'>Sorry we can't lower the CI (under 0.1) with 1 move :(</p>";
        $("#main").append(change);
      }

      function addToMulti(arr, places) {
        var newarray = [...arr].map((i) => ({ ...i }));
        for (i = 0; i < places.length; i++)
          newarray[i].delta = eval(newarray[i].delta) + eval(places[i]);
        return newarray;
      }

      function returnRatio(num) {
        if (num == 1) return 0;
        if (num == 2) return 0;
        if (num == 3) return 0.58;
        if (num == 4) return 0.9;
        if (num == 5) return 1.12;
        if (num == 6) return 1.24;
        if (num == 7) return 1.32;
      }
      function refresh(undo = false) {
        $("svg").remove();
        $(".buttons").remove();
        if (undo) {
          debugger;
          connectionsNew = JSON.parse(localStorage.getItem("connections"));
          valuesNew = JSON.parse(localStorage.getItem("values"));
          if (connectionsNew.length === 0 && valuesNew.length === 0) {
            alert("Nothing to undo");
          } else {
            connections = connectionsNew;
            values = valuesNew;
          }
        }
        buildtable();
        sumColunm(connections);
        $("#changeall").remove();
        var currentci1 = eval($("#ci").text().toString().substring(6));
        if (
          !connections.filter(function (a) {
            return a.delta == 0;
          }).length > 0 &&
          currentci1 > 0.1
        )
          //minRatioAll();
          minRatio();
      }
      function download(filename, text) {
        var element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(text)
        );
        element.setAttribute("download", filename);

        element.style.display = "none";
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
      }
    </script>
    <link href="Css/lightbox.css" rel="stylesheet" />
    <style type="text/css">
      a {
        text-decoration: none;
      }
      select {
        border: none;
        border-radius: 4px;
        background-color: #f1f1f1;
      }

      .redback {
        background: #ff9494;
      }

      .cons {
        direction: ltr;
        margin-top: 25px;
      }

      #ci {
        direction: ltr;
        padding: 10px;
        width: fit-content;
        border-radius: 10px;
        background: white;
      }

      #changeall {
        direction: ltr;
      }

      .normal {
        direction: ltr;
        position: fixed;
        right: 50px;
        top: 100px;
      }

      .tableresults table,
      td {
        border: 1px solid #ddd;
        text-align: center;
      }

      .tableresults table {
        width: 100%;
      }

      table {
        border-collapse: collapse !important;
        font-size: small;
      }

      .tableresults td {
        height: 75px;
        width: 75px;
        background-color: white;
      }

      a {
        cursor: pointer;
      }

      .redd {
        fill: Red;
      }

      svg {
        top: 0;
        left: 0;
        position: fixed;
        height: 100%;
        width: 100%;
        z-index: -100;
      }

      body {
        font-family: tahoma;
        font-size: large;
        background-image: url("images/back.jpg");
        background-size: cover;
        margin: 30px;
      }

      #addvals {
        vertical-align: middle;
      }

      #box {
        width: 50vw;
        height: 50vh;
        border: 1px solid gray;
        border-radius: 10px;
        top: 50%;
        left: 50%;
        position: fixed;
        transform: translate(-50%, -50%);
      }

      .txtarea {
        resize: none;
        direction: rtl;
        font-family: tahoma;
        width: 5vw;
        text-align: center;
        margin: 0, 2vw, 0, 2vw;
      }

      input[type="text"] {
        background: transparent;
        border: none;
        border-bottom: 1px solid #ddd;
        width: 30px;
        font-family: tahoma;
        font-size: large;
        text-align: center;
      }

      input[type="text"]:focus {
        text-align: center;
        background: transparent;
        border: none;
        border-bottom: 1px solid rgb(77, 144, 254);
        width: 30px;
        font-family: tahoma;
        font-size: large;
        outline-color: transparent;
      }

      .button {
        padding: 15px;
        border-radius: 10px;
        background-color: #bae1ff;
        box-shadow: 0 0 7px #b9b5b5;
      }

      .button:hover {
        box-shadow: 0 0 7px rgb(77, 144, 254);
        cursor: pointer;
      }

      #main {
        width: 100%;
        margin-top: 20px;
        display: inline-grid;
        justify-content: center;
      }

      #flextop {
        display: flex;
        justify-content: center;
      }

      #menu {
        text-align: center;
      }

      #logo {
        transition-duration: 0.5s;
        border-radius: 20px;
        box-shadow: 0px 0px 30px 0px rgba(0, 0, 0, 0.25);
      }

      #logo:hover {
        box-shadow: 0px 0px 30px 0px rgba(0, 0, 0, 0.5);
        cursor: pointer;
      }

      .menuitem {
        transition-duration: 0.2s;
        margin: 15px;
        height: 40px;
        width: 40px;
      }
      .menuitem:hover {
        outline: 2px solid #e4e4e4;
        outline-offset: 10px;
        cursor: pointer;
      }

      #myChart {
        max-width: 20%;
        background-color: white;
      }
      #chart {
        width: 100%;
        margin-top: 20px;
        display: flex;
        justify-content: center;
      }

      .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0, 0, 0); /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
      }

      /* Modal Content */
      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 30%;
      }

      /* The Close Button */
      .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }

      .close:hover,
      .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <p style="font-size: x-small">v2 Omer Hadar March 23</p>
    <div id="menu">
      <a href="images/Ahp.png" data-lightbox="logo" data-title=""
        ><img id="logo" src="images/logo.jpg" height="120px" width="auto"
      /></a>
      <br />
      <a href="images/Table.png" data-lightbox="table" data-title="">
        <img class="menuitem" src="images/doc.png" title="Hierarach Table" />
      </a>
      <a href="images/Legend.png" data-lightbox="Legend" data-title="">
        <img class="menuitem" src="images/faq.png" title="Lines Legend" />
      </a>
      <img
        id="dwn-btn"
        class="menuitem"
        src="images/download.png"
        title="Export To Excel"
      />
      <img id="reset" class="menuitem" src="images/trash.png" title="Reset" />
      <img id="undo" class="menuitem" src="images/undo.png" title="Undo" />
      <img id="save" class="menuitem" src="images/save.png" title="Save" />
      <img
        id="restore"
        class="menuitem"
        src="images/restore.png"
        title="Restore"
      />
    </div>

    <div id="main">
      <div id="flextop">
        <textarea class="txtarea" id="firstval" placeholder="Value"></textarea>

        <a
          id="addval"
          style="display: inline-block; margin-left: 25px"
          class="addvals button"
          >Add</a
        >
      </div>
    </div>
    <div id="chart"></div>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div style="display: flex" id="modal-data"></div>
      </div>
    </div>

    <br />
    <br />

    <script src="Scripts/lightbox.js"></script>
    <script>
      var modal = document.getElementById("myModal");

      var restore = document.getElementById("restore");
      var save = document.getElementById("save");

      var span = document.getElementsByClassName("close")[0];

      function restoreMe() {
        Util.restore($("#projects").val());
      }

      function deleteName() {
        Util.deleteName($("#projects").val());
        alert("Deleted! :)");
        $("#restore").click();
      }

      restore.onclick = function () {
        $("#modal-data").empty();
        var arr = Util.getNames();
        if (!arr) arr = [];
        if (arr.length == 0) {
          $("#modal-data").append("You didn't save anything yet :(");
        } else {
          let selectList = `<select id="projects" style="width:250px">`;
          arr.forEach((element) => {
            selectList += `<option value="${element}">${element}</option>`;
          });
          selectList += `</select>`;
          $("#modal-data").append(selectList);
          $("#modal-data").append(
            `<a
          onclick="restoreMe()"
          style="display: inline-block; margin-left: 25px"
          class="button"
          >Restore </a
        >`
          );
          $("#modal-data").append(
            `<a
          onclick="deleteName()"
          style="display: inline-block; margin-left: 25px; background-color:#ff9494"
          class="button"
          >Delete </a
        >`
          );
        }
        modal.style.display = "block";
      };

      function saveData() {
        var name = $("#saveName").val();
        if (name == "") {
          alert("Please enter a name");
        } else {
          Util.store(name);
          debugger;
          let names = Util.getNames();
          if (!names) names = [];
          if (!names.includes(name)) {
            names.push(name);
            Util.setNames(names);
          }
          alert("Saved! :)");
        }
      }

      save.onclick = function () {
        $("#modal-data").empty();
        var arr = Util.getNames();
        $("#modal-data").append(`<textarea
          class="txtarea"
          id="saveName"
          placeholder="Name"
        ></textarea>`);
        $("#modal-data").append(
          `<a
          onclick="saveData()"
          style="display: inline-block; margin-left: 25px"
          class="addvals button"
          >Save </a
        >`
        );

        modal.style.display = "block";
      };

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.style.display = "none";
      };

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
    </script>
  </body>
</html>
